---
title: "p8130_final"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(arsenal)
library(MASS)
library(HH)
library(leaps)
library(corrplot)
library(broom)
df = read.csv("./data/Lawsuit.csv")%>%
  janitor::clean_names()
```
# descriptive table of data

```{R}
tableby(gender~sal94+sal95+prate+exper ,data=df,test=FALSE,numeric.stas=c("meansd","median","iqr"))%>%
  summary(text=TRUE)

```

# data distribution,
```{r}

ggplot(aes(x=sal94),data=df)+geom_density()
ggplot(aes(x=sal95),data=df)+geom_density()

```


# transformation
```{r}
fit_0=lm(sal94~factor(dept)+factor(gender)+factor(clin)+factor(cert)+prate+exper+factor(rank),data=df)

boxcox(fit_0,data=df)
df=
  df %>%
  mutate(ln94=log(sal94),
         ln95=log(sal95))
ggplot(aes(x=ln94),data=df)+geom_density()
ggplot(aes(x=ln95),data=df)+geom_density()
fit_1 = lm(ln94~factor(dept)+factor(gender)+factor(clin)+factor(cert)+prate+exper+factor(rank),data=df)
summary(fit_1)


```
# interaction
```{r}
df%>%
  dplyr::select(-id,-sal94,-sal95,-ln94,-ln95)%>%
  pairs()
fit_2 = lm(ln94~factor(dept)*factor(gender)+factor(clin)+factor(cert)+prate+exper+factor(rank),data=df)
anova(fit_1,fit_2)
fit_3 = lm(ln94~factor(gender)*factor(clin)+factor(dept)+factor(cert)+prate+exper+factor(rank),data=df)
fit_4 = lm(ln94~factor(gender)*factor(cert)+factor(dept)+factor(clin)+prate+exper+factor(rank),data=df)
fit_5 = lm(ln94~factor(gender)*prate+factor(dept)+factor(clin)+factor(cert)+exper+factor(rank),data=df)
fit_6= lm(ln94~factor(gender)*exper+factor(dept)+factor(clin)+factor(cert)+prate+factor(rank),data=df)
fit_7 = lm(ln94~factor(gender)*factor(rank)+factor(dept)+factor(clin)+factor(cert)+prate+exper,data=df)
anova(fit_1,fit_3)
anova(fit_1,fit_4)
anova(fit_1,fit_5)
anova(fit_1,fit_6)
anova(fit_1,fit_7)

```
interaction of rank and exper

# confonder
```{r}
fit1 = lm(ln94~factor(gender),data=df)
fit2 = lm(ln94~factor(gender)+factor(dept),data=df)
fit3 = lm(ln94~factor(gender)+factor(clin),data=df)
fit4 = lm(ln94~factor(gender)+factor(cert),data=df)
fit5 = lm(ln94~factor(gender)+prate,data=df)
fit6 = lm(ln94~factor(gender)+exper,data=df)
fit7 = lm(ln94~factor(gender)+factor(rank),data=df)
tidy(fit1)[2,2]
tidy(fit2)[2,2]
tidy(fit3)[2,2]
tidy(fit4)[2,2]
tidy(fit5)[2,2]
tidy(fit6)[2,2]
tidy(fit7)[2,2]
```
dept and prate are confonder
# model selection

```{r}
fit=lm(ln94~factor(gender)*factor(rank)+factor(dept)+prate,data=df)

plot(fit)

```

# model diagnosis
















```{r}


```